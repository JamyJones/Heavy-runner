name: TRANSLATE JAVA_GUIDE

on:
  workflow_dispatch:

jobs:
  generate-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.generate.outputs.matrix }}
    steps:
      - name: Generate matrix dynamically
        id: generate
        run: |
          # Generate a JSON array of chunk IDs (1 to 100)
          MATRIX=$(seq 10 30 | jq -c '[inputs]')
          echo "::set-output name=matrix::$MATRIX"

  Get-info-jaon:
    needs: generate-matrix
    runs-on: ubuntu-latest
    strategy:
      matrix:
        chunk_id: ${{ fromJson(needs.generate-matrix.outputs.matrix) }}
    steps:
      - name: Checkout private tools
        uses: actions/checkout@v4
        with:
          repository: john4650-hub/Hello-Android-CI
          token: ${{ secrets.TK }}
      - name: install ffmpeg
        uses: animMouse/setup-ffmpeg@v1
      - name: install deps
        run: |
          pip install yt-dlp
          pip install bs4

      - name: Get info.json
        run: |
          touch info.json
          for page in $(seq 1 5);do
            echo "$page" | bash scripts/otherScripts/yewtube/getPage.sh > "index$page.html"
          done
          python scripts/otherScripts/yewtube/scrap.py
          python scripts/pyScripts/extractVideoInfo.py

      - name: Upload modifications
        uses: actions/upload-artifact@v4
        with:
          name: json_files
          path: |
            ./info.json
            ./assets/db/data.json
          retention-days: 1
  proccess-json-data:
    needs:
      - generate-matrix
      - translate-the-guide
    runs-on: ubuntu-latest
    strategy:
      matrix:
        chunk_id: ${{ fromJson(needs.generate-matrix.outputs.matrix) }}
    steps:

      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          repository: john4650-hub/Hello-Android-CI
          token: ${{ secrets.TK }}
      - name: install deps
        run: |
          pip install yt-dlp
          cargo install gifski

      - name: Download artifacts
        uses: actions/download-artifact@v4
        with:
          path: ./

      - name: PROCESS THE REST OF THE FILES
        run: |
          ls 
          mv json_files/* .
          mv data.json assets/db/
          python scripts/pyScripts/ytStudy.py 
          python scripts/pyScripts/updateFiles.py
          python scripts/otherScripts/yewtube/getImgRawUrl.py
          python scripts/otherScripts/yewtube/updateFiles.py
          #name: modified-files-${{ matrix.chunk_id }}

      - name: Merge all changes
        run: |
          git clone https://github.com/Snailclimb/JavaGuide
          for dir in workspace/modified-files-*/; do
            cp -r "$dir"* .
          done
          cd JavaGuide
          git remote remove origin
          git remote add origin 'https://github.com/john4650-hub/JavaGuide.git'
          git remote set-url origin "https://john4650-hub:$1@github.com/john4650-hub/JavaGuide.git"
          git config --global user.name "john4650-hub"
          git config --global user.email "johndelvin51@gmail.com"
          git config --global --add safe.directory "$(pwd)"
          git add .
          git commit -m "Push changes"
          git push -f --set-upstream origin main
        env:
          GITHUB_TOKEN: ${{ secrets.TK }}
        shell: bash

