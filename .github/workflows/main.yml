name: DOWNLOAD MANGA CHAPTERS

on:
  workflow_dispatch:

jobs:
  generate-matrix:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.generate.outputs.matrix }}
    steps:
      - name: Generate matrix dynamically
        id: generate
        run: |
          # Generate a JSON array of chunk IDs (1 to 100)
          MATRIX=$(seq 0 100 | jq -c '[inputs]')
          echo "::set-output name=matrix::$MATRIX"

  translate-the-guide:
    needs: generate-matrix
    runs-on: ubuntu-latest
    strategy:
      matrix:
        chunk_id: ${{ fromJson(needs.generate-matrix.outputs.matrix) }}
    steps:
      - name: Checkout private tools
        uses: actions/checkout@v4
        with:
          repository: john4650-hub/Hello-Android-CI
          token: ${{ secrets.TK }}
      - name: install ffmpeg
        uses: animMouse/setup-ffmpeg@v1
      - name: install deps
        run: |
          sudo apt-get update
          sudo apt-get install imagemagick -y
          sudo apt-get install pdftk -y
          pip install bs4
          pip install requests
 
      - name: Get Chapters
        run: |
          git clone https://github.com/Snailclimb/JavaGuide
          chmod +x scripts/*.sh
          ./scripts/generate_sed_file.sh
      - name: Running heavy process Here
        run: |
          chmod +x run_command.sh
          ./run_command.sh 0.${{ github.run_number }}.0 $GITHUB_TOKEN ${{ matrix.chunk_id }}
        env:
          GITHUB_TOKEN: ${{ secrets.TK }}
        shell: bash
